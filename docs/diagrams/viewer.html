<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagrammes UML - Syst√®me de Gestion Locative Blockchain</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#4f46e5',
                primaryTextColor: '#fff',
                primaryBorderColor: '#4338ca',
                lineColor: '#6366f1',
                secondaryColor: '#818cf8',
                tertiaryColor: '#c7d2fe'
            }
        });
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        nav {
            background: #f8fafc;
            padding: 20px;
            border-bottom: 2px solid #e2e8f0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        nav a {
            text-decoration: none;
            color: #4f46e5;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        nav a:hover {
            background: #4f46e5;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        .section {
            padding: 40px;
            border-bottom: 1px solid #e2e8f0;
        }

        .section:last-child {
            border-bottom: none;
        }

        .section h2 {
            color: #4f46e5;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #4f46e5;
        }

        .section p {
            color: #64748b;
            margin-bottom: 30px;
            line-height: 1.6;
            font-size: 1.1em;
        }

        .diagram-container {
            background: #f8fafc;
            padding: 30px;
            border-radius: 12px;
            margin: 20px 0;
            overflow-x: auto;
            border: 2px solid #e2e8f0;
        }

        .mermaid {
            display: flex;
            justify-content: center;
            min-height: 200px;
        }

        .info-box {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .info-box h3 {
            color: #1e40af;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #1e3a8a;
            margin: 0;
        }

        .warning-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .warning-box h3 {
            color: #92400e;
            margin-bottom: 10px;
        }

        footer {
            background: #1e293b;
            color: white;
            text-align: center;
            padding: 30px;
        }

        footer a {
            color: #818cf8;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
            font-style: italic;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            nav ul {
                flex-direction: column;
                align-items: center;
            }

            .section {
                padding: 20px;
            }

            .diagram-container {
                padding: 15px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>üìä Diagrammes UML</h1>
            <p>Syst√®me de Gestion Locative Blockchain</p>
        </header>

        <nav>
            <ul>
                <li><a href="#classes">üì¶ Classes</a></li>
                <li><a href="#use-cases">üéØ Cas d'Utilisation</a></li>
                <li><a href="#auth">üîê Authentification</a></li>
                <li><a href="#contract">üìù Contrats</a></li>
                <li><a href="#payment">üí∞ Paiements</a></li>
            </ul>
        </nav>

        <!-- Diagramme de Classes (Simplifi√© pour l'exemple) -->
        <section id="classes" class="section">
            <h2>üì¶ Diagramme de Classes</h2>
            <p>Architecture compl√®te du syst√®me avec mod√®les de donn√©es, smart contracts et services.</p>

            <div class="info-box">
                <h3>üí° Astuce</h3>
                <p>Pour voir le diagramme complet en haute qualit√©, ouvrez le fichier <code>class_diagram.md</code> dans
                    VS Code et appuyez sur <code>Ctrl+Shift+V</code></p>
            </div>

            <div class="diagram-container">
                <div class="mermaid">
                    classDiagram
                    class User {
                    +int id
                    +string email
                    +string passwordHash
                    +enum role
                    +string blockchainAddress
                    +comparePassword() bool
                    +toSafeObject() Object
                    }

                    class Property {
                    +int id
                    +int ownerId
                    +string address
                    +string type
                    +decimal area
                    +enum status
                    }

                    class Contract {
                    +int id
                    +int propertyId
                    +int landlordId
                    +int tenantId
                    +string smartContractAddress
                    +decimal rentAmount
                    +enum status
                    }

                    class Payment {
                    +int id
                    +int contractId
                    +date dueDate
                    +decimal amount
                    +enum status
                    +string transactionHash
                    }

                    class RentalContract {
                    +address landlord
                    +address tenant
                    +uint256 rentAmount
                    +signContract()
                    +terminateContract()
                    }

                    User "1" --> "0..*" Property : owns
                    User "1" --> "0..*" Contract : landlord/tenant
                    Property "1" --> "0..*" Contract : has
                    Contract "1" --> "0..*" Payment : generates
                    Contract --> RentalContract : deployed as
                </div>
            </div>
        </section>

        <!-- Diagramme de Cas d'Utilisation (Simplifi√©) -->
        <section id="use-cases" class="section">
            <h2>üéØ Principaux Cas d'Utilisation</h2>
            <p>Interactions entre les acteurs (Locataire, Propri√©taire, Admin) et le syst√®me.</p>

            <div class="diagram-container">
                <div class="mermaid">
                    graph LR
                    Tenant[üë§ Locataire]
                    Landlord[üè† Propri√©taire]
                    Admin[üë®‚Äçüíº Admin]

                    Tenant --> UC1[S'inscrire]
                    Tenant --> UC2[Rechercher propri√©t√©]
                    Tenant --> UC3[Signer contrat]
                    Tenant --> UC4[Payer loyer]
                    Tenant --> UC5[D√©poser litige]

                    Landlord --> UC1
                    Landlord --> UC6[Cr√©er propri√©t√©]
                    Landlord --> UC7[Cr√©er contrat]
                    Landlord --> UC3
                    Landlord --> UC8[Retirer fonds]
                    Landlord --> UC5

                    Admin --> UC9[R√©soudre litige]

                    style Tenant fill:#e3f2fd
                    style Landlord fill:#fff3e0
                    style Admin fill:#f3e5f5
                </div>
            </div>

            <div class="warning-box">
                <h3>üìå Note</h3>
                <p>Ce diagramme est simplifi√©. Consultez <code>use_case_diagram.md</code> pour voir les 32 cas
                    d'utilisation complets.</p>
            </div>
        </section>

        <!-- S√©quence : Authentification -->
        <section id="auth" class="section">
            <h2>üîê S√©quence : Connexion Utilisateur</h2>
            <p>Flux complet d'authentification avec validation et g√©n√©ration de JWT.</p>

            <div class="diagram-container">
                <div class="mermaid">
                    sequenceDiagram
                    actor User as üë§ Utilisateur
                    participant Frontend
                    participant API as AuthController
                    participant DB as Base de Donn√©es
                    participant JWT

                    User->>Frontend: Saisir email + mot de passe
                    Frontend->>API: POST /api/auth/login
                    API->>DB: SELECT user WHERE email = ?
                    DB-->>API: User data
                    API->>API: bcrypt.compare(password)

                    alt Credentials valides
                    API->>JWT: generateToken(user.id)
                    JWT-->>API: JWT token
                    API-->>Frontend: 200 OK + token
                    Frontend->>Frontend: Stocker token
                    Frontend-->>User: Redirection Dashboard
                    else Credentials invalides
                    API-->>Frontend: 401 Unauthorized
                    Frontend-->>User: Message d'erreur
                    end
                </div>
            </div>
        </section>

        <!-- S√©quence : Contrat -->
        <section id="contract" class="section">
            <h2>üìù S√©quence : Cr√©ation et Signature de Contrat</h2>
            <p>Processus complet depuis la cr√©ation jusqu'au d√©ploiement blockchain.</p>

            <div class="diagram-container">
                <div class="mermaid">
                    sequenceDiagram
                    actor Landlord as üè† Propri√©taire
                    actor Tenant as üë§ Locataire
                    participant API as ContractController
                    participant BC as BlockchainService
                    participant Ganache as üîó Blockchain

                    Landlord->>API: POST /api/contracts (cr√©er)
                    API->>API: Sauvegarder (status: draft)
                    API-->>Landlord: Contrat cr√©√©

                    Landlord->>API: POST /api/contracts/:id/sign
                    API->>API: landlordSigned = true
                    API-->>Landlord: Signature enregistr√©e

                    Tenant->>API: POST /api/contracts/:id/sign
                    API->>API: tenantSigned = true

                    Note over API,Ganache: D√©ploiement Smart Contracts
                    API->>BC: deployRentalContract()
                    BC->>Ganache: Deploy transaction
                    Ganache-->>BC: Contract address

                    API->>BC: deployPaymentManager()
                    BC->>Ganache: Deploy transaction
                    Ganache-->>BC: Contract address

                    API->>API: Update contract (status: active)
                    API-->>Tenant: Contrat actif ‚úÖ
                </div>
            </div>
        </section>

        <!-- S√©quence : Paiement -->
        <section id="payment" class="section">
            <h2>üí∞ S√©quence : Paiement de Loyer</h2>
            <p>Transaction blockchain avec calcul automatique des p√©nalit√©s.</p>

            <div class="diagram-container">
                <div class="mermaid">
                    sequenceDiagram
                    actor Tenant as üë§ Locataire
                    participant Frontend
                    participant MetaMask as ü¶ä MetaMask
                    participant API as PaymentController
                    participant Ganache as üîó Blockchain
                    participant SC as PaymentManager.sol

                    Tenant->>Frontend: Clic "Payer"
                    Frontend->>MetaMask: Demande confirmation
                    MetaMask-->>Tenant: Popup confirmation
                    Tenant->>MetaMask: Approuve

                    Frontend->>API: POST /api/payments/:id/pay
                    API->>Ganache: makePayment(paymentIndex)
                    Ganache->>SC: Execute makePayment()

                    SC->>SC: calculatePenalty()
                    alt Paiement en retard
                    SC->>SC: penalty = (days * rate * amount) / 100
                    else √Ä temps
                    SC->>SC: penalty = 0
                    end

                    SC->>SC: Update payment.isPaid = true
                    SC->>SC: emit PaymentMade(id, amount, penalty)

                    Ganache-->>API: Transaction receipt + hash
                    API->>API: Update DB (status: paid)
                    API-->>Frontend: Paiement confirm√© ‚úÖ
                    Frontend-->>Tenant: Notification succ√®s
                </div>
            </div>

            <div class="info-box">
                <h3>‚ö° Performance</h3>
                <p>Sur Ganache (local), les transactions sont instantan√©es. Sur un r√©seau public (Sepolia, Mainnet),
                    comptez 15-30 secondes.</p>
            </div>
        </section>

        <footer>
            <p><strong>Syst√®me de Gestion Locative Blockchain</strong></p>
            <p>Tous les diagrammes sources : <a href="./README.md">docs/diagrams/</a></p>
            <p>Pour voir les diagrammes complets en haute qualit√©, ouvrez les fichiers .md dans VS Code</p>
        </footer>
    </div>

    <script>
        // Smooth scroll pour la navigation
        document.querySelectorAll('nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });
    </script>
</body>

</html>