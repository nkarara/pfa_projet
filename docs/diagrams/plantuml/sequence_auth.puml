@startuml Sequence_Authentification

title Séquence : Authentification Utilisateur

actor "Utilisateur" as User
participant "Frontend" as UI
participant "AuthController" as Auth
participant "User Model" as Model
database "PostgreSQL" as DB
participant "JWT Service" as JWT

== Inscription ==
User -> UI: Saisir informations
UI -> Auth: POST /api/auth/register
Auth -> Model: Valider email unique
Model -> DB: SELECT WHERE email = ?
DB --> Model: Résultat

alt Email déjà utilisé
    Model --> Auth: Erreur
    Auth --> UI: 400 Bad Request
    UI --> User: Erreur affichée
else Email disponible
    Auth -> Model: Hash password (bcrypt)
    Model -> DB: INSERT nouveau user
    DB --> Model: User créé
    Auth -> JWT: generateToken(user.id)
    JWT --> Auth: Token JWT
    Auth --> UI: 201 Created + token
    UI -> UI: Stocker token
    UI --> User: Redirection Dashboard
end

== Connexion ==
User -> UI: Email + mot de passe
UI -> Auth: POST /api/auth/login
Auth -> Model: findOne(email)
Model -> DB: SELECT * WHERE email = ?
DB --> Model: User data

alt User trouvé
    Auth -> Model: comparePassword()
    alt Mot de passe correct
        Auth -> JWT: generateToken(user.id)
        JWT --> Auth: Token JWT
        Auth --> UI: 200 OK + token
        UI -> UI: Stocker token
        UI --> User: Redirection Dashboard
    else Mot de passe incorrect
        Auth --> UI: 401 Unauthorized
        UI --> User: Erreur
    end
else User non trouvé
    Auth --> UI: 401 Unauthorized
    UI --> User: Erreur
end

@enduml
